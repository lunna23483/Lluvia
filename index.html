<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Caza-EPP | CREAMOSS S.O S.A.S</title>
<style>
  :root{
    --ui-bg: rgba(255,255,255,0.85);
    --ui-radius: 12px;
    --panel-pad: 12px;
    --font: "Poppins", "Segoe UI", Roboto, Arial, sans-serif;
  }
  html,body{height:100%;margin:0;font-family:var(--font)}
  body{overflow:hidden;background: linear-gradient(#87CEEB,#ffffff);}
  #gameCanvas{display:block}
  #hud{
    position:fixed; left:12px; top:12px;
    background:var(--ui-bg); padding:var(--panel-pad);
    border-radius:var(--ui-radius); box-shadow:0 6px 20px rgba(0,0,0,0.12);
    z-index:30;
  }
  #hud .line{font-size:18px; margin:6px 0}
  #hud small{opacity:0.8; font-size:13px}
  #topRight{
    position:fixed; right:12px; top:12px;
    background:var(--ui-bg); padding:var(--panel-pad);
    border-radius:var(--ui-radius); box-shadow:0 6px 20px rgba(0,0,0,0.12);
    z-index:30; text-align:right;
  }
  #gameOver{
    position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
    background:var(--ui-bg); padding:18px; border-radius:18px;
    box-shadow:0 10px 40px rgba(0,0,0,0.2); z-index:60; display:none; text-align:center;
  }
  button.primary{
    background:#2b7cff; color:white; border:0; padding:10px 16px; border-radius:10px;
    cursor:pointer; font-weight:600; font-size:16px;
  }
  button.ghost{
    background:transparent; border:1px solid rgba(0,0,0,0.1); padding:8px 12px; border-radius:8px;
    cursor:pointer;
  }
  #startOverlay{
    position:fixed; left:0; top:0; right:0; bottom:0;
    display:flex; align-items:center; justify-content:center;
    z-index:70; backdrop-filter: blur(3px);
  }
  #startCard{
    background:var(--ui-bg); padding:24px; border-radius:16px; text-align:center; box-shadow:0 10px 40px rgba(0,0,0,0.18);
  }
  #levelBadge{display:inline-block; margin-left:8px; padding:6px 10px; background:rgba(0,0,0,0.06); border-radius:10px;}
  .small{font-size:13px; color:#333; opacity:0.85}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<div id="hud">
  <div class="line">üß¢ Puntos: <strong id="score">0</strong></div>
  <div class="line">‚è±Ô∏è Tiempo: <strong id="time">60</strong>s <span id="levelBadge">Nivel <strong id="level">1</strong></span></div>
  <div class="line small">R√©cord: <strong id="highScore">0</strong></div>
</div>

<div id="topRight">
  <div class="small">Objetos atrapados: <span id="caught">0</span></div>
  <div style="margin-top:8px">
    <button class="ghost" id="toggleSound">üîä Sonido</button>
    <button class="ghost" id="restartBtn">üîÅ Reiniciar</button>
  </div>
</div>

<div id="gameOver">
  <h2 id="gameOverTitle">üéâ ¬°Fin del juego!</h2>
  <p>Puntaje final: <strong id="finalScore">0</strong></p>
  <p class="small" id="finalMsg"></p>
  <div style="margin-top:12px">
    <button class="primary" onclick="restartGame()">Jugar otra vez</button>
    <button class="ghost" onclick="downloadScore()">Descargar puntaje</button>
  </div>
</div>

<div id="startOverlay">
  <div id="startCard">
    <h1>Caza-EPP ü™ñ</h1>
<p class="small">CREAMOSS S.O S.A.S</p>

    <p class="small">Atrapa cascos, guantes, gafas, botas, arneses y slingas. Evita la basura ‚ùå. Cada 15s sube el nivel.</p>
    <div style="margin-top:12px">
      <button id="startBtn" class="primary">JUGAR</button>
      <button id="howBtn" class="ghost" style="margin-left:8px">¬øC√≥mo jugar?</button>
    </div>
    <p class="small" style="margin-top:10px">Haz clic o toca en los objetos para atraparlos. El sonido se activa al iniciar.</p>
  </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;

window.addEventListener('resize', ()=>{ W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; });

// Estado de juego
let score = 0, timeLeft = 60, items = [], particles = [];
let spawnRate = 0.05, baseSpeed = 2.2, caught = 0;
let gameInterval = null, timerInterval = null, playing = false, level = 1;
let highScore = parseInt(localStorage.getItem('cazaEPP_high')||'0',10) || 0;
let soundOn = true;
document.getElementById('highScore').textContent = highScore;

// EPP y basura (ahora con arn√©s y slinga)
const EPP = [
  {emoji:'ü™ñ', pts:12},
  {emoji:'üß§', pts:6},
  {emoji:'üëì', pts:8},
  {emoji:'ü•æ', pts:9},
  {emoji:'ü¶∫', pts:10, rare:true}, // arn√©s
  {emoji:'ü™¢', pts:7, rare:true},  // slinga
];
const fake = {emoji:'‚ùå', pts:-7};

// Audio
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx = null, musicInterval = null, musicGain = null;

function initAudio(){
  if(audioCtx) return;
  audioCtx = new AudioCtx();
  musicGain = audioCtx.createGain(); musicGain.gain.value = 0.09;
  musicGain.connect(audioCtx.destination);
}

function beep(freq=440,dur=120, type='sine', gain=0.12){
  if(!audioCtx) return;
  const o = audioCtx.createOscillator(), g = audioCtx.createGain();
  o.type=type; o.frequency.value=freq; g.gain.value=gain;
  o.connect(g); g.connect(audioCtx.destination);
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur/1000);
  o.stop(audioCtx.currentTime + dur/1000 + 0.02);
}

function startMusic(){
  if(!audioCtx || musicInterval) return;
  musicInterval = setInterval(()=>{
    if(!soundOn) return;
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type='sine'; o.frequency.value=110; g.gain.value=0.09;
    o.connect(g); g.connect(musicGain); o.start();
    g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.18);
    o.stop(audioCtx.currentTime + 0.18);
    setTimeout(()=>{if(!soundOn) return; beep(1200,60,'square',0.03)},120);
    setTimeout(()=>{if(!soundOn) return; beep(1800,40,'square',0.02)},180);
  },400);
}
function stopMusic(){ if(musicInterval){ clearInterval(musicInterval); musicInterval=null; } }

function soundAcierto(){ beep(900,110,'square',0.12); beep(1300,60,'sine',0.06);}
function soundError(){ beep(220,220,'sawtooth',0.12);}
function soundCountdown(){ beep(1000,80,'sine',0.08);}
function soundVictory(){ beep(1200,120,'square',0.14); setTimeout(()=>beep(900,120,'square',0.12),140); setTimeout(()=>beep(1600,140,'sine',0.12),300);}

function spawnParticles(x,y, color='#fff'){
  for(let i=0;i<12;i++){
    particles.push({
      x,y,
      vx:(Math.random()-0.5)*6,
      vy:(Math.random()-1.5)*6,
      life:30 + Math.random()*30,
      size:4 + Math.random()*5,
      color
    });
  }
}

// Crear item (incluye rareza)
function createItem(){
  const isFake = Math.random() < 0.18;
  let pick, x=Math.random()*(W-40), sp=baseSpeed + Math.random()*2 + (level-1)*0.6;
  if(isFake){
    items.push({emoji:fake.emoji, x, y:-40, speed:sp, pts:fake.pts, fake:true});
  } else {
    do { pick = EPP[Math.floor(Math.random()*EPP.length)]; } 
    while(pick.rare && Math.random() > 0.25);
    items.push({emoji:pick.emoji, x, y:-40, speed:sp, pts:pick.pts, fake:false});
  }
}

// Fondo din√°mico
function drawBackground(){
  let g = ctx.createLinearGradient(0,0,0,H);
  if(level===1){ g.addColorStop(0,'#87CEEB'); g.addColorStop(1,'#ffffff');}
  else if(level===2){ g.addColorStop(0,'#FFD194'); g.addColorStop(1,'#FFD19488');}
  else { g.addColorStop(0,'#0f172a'); g.addColorStop(1,'#001428'); }
  ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

  if(level===1){
    ctx.fillStyle='rgba(255,255,255,0.7)';
    for(let i=0;i<5;i++){ const cx=(i*W/5 + (Date.now()/50)%200)%W; ctx.beginPath(); ctx.ellipse(cx,80+i*10,120,40,0,0,Math.PI*2); ctx.fill(); }
  } else if(level===3){
    ctx.fillStyle='rgba(0,0,0,0.25)';
    for(let i=0;i<40;i++){ const bw=60+(i%6)*20; ctx.fillRect(i*(W/40),H-120-bw%40,bw/6,120+(i%5)*10);}
  }
}

// Dibujar items y part√≠culas
function draw(){
  drawBackground();
  ctx.font="48px serif"; ctx.textAlign="left"; ctx.textBaseline="middle";
  items.forEach((it, idx)=>{
    ctx.fillText(it.emoji,it.x,it.y);
    it.y += it.speed;
    if(it.y>H+60) items.splice(idx,1);
  });

  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    ctx.beginPath(); ctx.fillStyle=p.color; ctx.globalAlpha=Math.max(0,p.life/60);
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();
    p.x+=p.vx; p.y+=p.vy; p.vy+=0.18; p.life--;
    if(p.life<=0) particles.splice(i,1);
  }
  ctx.globalAlpha=1;
}

// Click / touch
canvas.addEventListener('click', (e)=>{
  if(!playing) return; if(audioCtx && audioCtx.state==='suspended') audioCtx.resume();
  const x=e.clientX, y=e.clientY;
  for(let i=items.length-1;i>=0;i--){
    const it=items[i];
    if(x>it.x && x<it.x+48 && y>it.y-28 && y<it.y+28){
      score += it.pts;
      if(it.fake) soundError(); else {soundAcierto(); caught++;}
      spawnParticles(it.x+20,it.y,it.fake?'#ff7777':'#fff9c4');
      items.splice(i,1); updateHud(); break;
    }
  }
});
canvas.addEventListener('touchstart',(ev)=>{ const t=ev.touches[0]; canvas.dispatchEvent(new MouseEvent('click',{clientX:t.clientX,clientY:t.clientY}));});

// HUD
function updateHud(){
  document.getElementById('score').textContent=score;
  document.getElementById('time').textContent=timeLeft;
  document.getElementById('caught').textContent=caught;
  document.getElementById('level').textContent=level;
}

// Game loop
function gameTick(){
  if(Math.random() < spawnRate + (level-1)*0.01) createItem();
  if(Math.random() < 0.005 * level) createItem();
  draw();
  if(timeLeft<=0) endGame();
}

// Timer y nivel
function startTimer(){
  timerInterval=setInterval(()=>{
    timeLeft--;
    if(timeLeft<=5 && timeLeft>0) soundCountdown();
    const elapsed=60-timeLeft, newLevel=Math.floor(elapsed/15)+1;
    if(newLevel!==level){ level=newLevel; spawnRate+=0.01; baseSpeed+=0.3; if(soundOn && audioCtx) beep(880,120,'sawtooth',0.08);}
    updateHud();
    if(timeLeft<=0) clearInterval(timerInterval);
  },1000);
}

// Inicio / fin / reinicio
function startGame(){
  initAudio(); if(audioCtx.state==='suspended') audioCtx.resume();
  startMusic(); playing=true; score=0; timeLeft=60; items=[]; particles=[]; caught=0; spawnRate=0.05; baseSpeed=2.2; level=1;
  updateHud(); if(gameInterval) clearInterval(gameInterval); gameInterval=setInterval(gameTick,30);
  if(timerInterval) clearInterval(timerInterval); startTimer();
  document.getElementById('startOverlay').style.display='none';
  document.getElementById('gameOver').style.display='none';
}
function endGame(){
  playing=false; clearInterval(gameInterval); clearInterval(timerInterval); stopMusic(); soundVictory();
  document.getElementById('finalScore').textContent=score;
  if(score>highScore){ highScore=score; localStorage.setItem('cazaEPP_high',highScore); document.getElementById('highScore').textContent=highScore; document.getElementById('finalMsg').textContent='¬°Nuevo r√©cord! üèÜ';}
  else document.getElementById('finalMsg').textContent='Sigue intent√°ndolo para superar tu r√©cord.';
  document.getElementById('gameOver').style.display='block';
}
function restartGame(){ document.getElementById('startOverlay').style.display='flex'; document.getElementById('gameOver').style.display='none'; stopMusic(); if(audioCtx) audioCtx.suspend && audioCtx.suspend(); }

// Botones
document.getElementById('toggleSound').addEventListener('click', ()=>{ soundOn=!soundOn; document.getElementById('toggleSound').textContent=soundOn?'üîä Sonido':'üîà Silencio'; if(!soundOn) stopMusic(); else startMusic();});
document.getElementById('restartBtn').addEventListener('click', ()=>{ restartGame();});
document.getElementById('startBtn').addEventListener('click', ()=>{ initAudio(); if(audioCtx.state==='suspended') audioCtx.resume(); startGame(); });
document.getElementById('howBtn').addEventListener('click', ()=>{ alert('Haz clic/toca los EPP para atraparlos. Evita la basura ‚ùå. Cada 15s sube el nivel y todo cae m√°s r√°pido. ¬°Consigue tu r√©cord!'); });

// Descargar puntaje
function downloadScore(){
  const data = `Caza-EPP ‚Äî Puntaje: ${score}  R√©cord: ${highScore}  Fecha: ${new Date().toLocaleString()}`;
  const blob = new Blob([data], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='puntaje_cazaEPP.txt'; a.click();
  URL.revokeObjectURL(url);
}

// Render loop idle
updateHud();
(function renderLoop(){
  if(!playing){
    ctx.clearRect(0,0,W,H);
    drawBackground();
    ctx.font="60px serif";
    ctx.fillText('ü™ñ üß§ üëì ü•æ ü¶∫ ü™¢',40,120);
  }
  requestAnimationFrame(renderLoop);
})();
</script>
</body>
</html>



